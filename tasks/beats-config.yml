---
# Configure Beats Node

- name: Create {{ beat }} paths if defined
  file:
    path: '{{ beat_path_item }}'
    state: directory
  loop: >
    {{ beat_conf[beat]['path'] | default({})
      | dict2items | map(attribute='value') | list
      | union([beats_pid_dir, beats_conf_dir]) | unique }}
  loop_control:
    loop_var: beat_path_item

#Copy the default file
- name: Copy Default File for Instance
  template:
    src: beat.j2
    dest: '{{ instance_default_file }}'
    mode: 0644
    force: true
    owner: root
    group: root
  notify: restart {{ beat }}

#Copy templated config file
- name: Copy Configuration File for {{ beat }}
  template:
    src: beat.yml.j2
    dest: '{{ conf_file }}'
    mode: 0644
    force: true
    owner: root
    group: root
  notify: restart {{ beat }}
