---
- name: Ensure libselinux-python on CentOS 6.x
  yum:
    name: libselinux-python
    state: present
    update_cache: true
  register: libselinux_install
  until: libselinux_install is succeeded
  when:
    - ansible_distribution == "CentOS"
    - ansible_distribution_major_version == "6"

- name: Importing elastic GPG Key
  rpm_key:
    key: '{{ elastic_gpg_key }}'
    state: present
  register: installed_key
  until: installed_key is succeeded

- name: Add beats yum repository
  yum_repository:
    name: beats
    description: Beats repository
    file: '{{ beats_yum_repo_file }}'
    baseurl: '{{ repo_url }}'
    gpgcheck: true
    gpgkey: '{{ elastic_gpg_key }}'
    enabled: true
    state: present

# - name: RedHat - install yum-version-lock
#   yum:
#     name:
#       - yum-utils
#       - yum-plugin-versionlock
#     state: present
#     update_cache: true
#   register: versionlock_install
#   until: versionlock_install is succeeded

# - name: Read yum-lock list
#   slurp:
#     src: /etc/yum/pluginconf.d/versionlock.list
#   register: versionlock_list

# - name: RedHat - unlock {{ beat }} for install
#   command: yum versionlock delete {{ beat }}
#   args:
#     warn: false
#   register: versionlock_delete
#   changed_when: >-
#     beat in versionlock_delete.stdout
#   when: >-
#     beat in (versionlock_list['content'] | b64decode)
#   tags:
#     - molecule-idempotence-notest
